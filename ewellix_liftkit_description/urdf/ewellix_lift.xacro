<?xml version="1.0"?>


<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:macro name="ewellix_lift" params="
    name
    tf_prefix:=''
    parent:=world
    height_limit:=0.7
    omit_plates:=false
    is_700:=true
    is_500:=false
    use_fake_hardware:=false
    com_port:=/dev/ttyUSB0
    use_gazebo:=false
    generate_ros2_control_tag=true
    *origin
  ">

    <xacro:if value="${not omit_plates}">
      <xacro:property name="lift_base_link_name" value="${tf_prefix}ewellix_lift_base_link"/>
    </xacro:if>

    <!--For 700 mm stroke-->
    <xacro:if value="${is_700}">

      <xacro:if value="${height_limit >= 0.7}">
        <xacro:property name="height_limit" value="0.7"/>
      </xacro:if>

      <xacro:property name="base_mass_value" value="1.7383784"/>
      <xacro:property name="base_box_size" value="0.220 0.200 0.015"/>
      <xacro:property name="lift_base_link_ixx" value="0.0057788770" scope="parent"/>
      <xacro:property name="lift_base_link_ixy" value="0.0" scope="parent"/>
      <xacro:property name="lift_base_link_ixz" value="0.0" scope="parent"/>
      <xacro:property name="lift_base_link_iyy" value="0.0070031715" scope="parent"/>
      <xacro:property name="lift_base_link_iyz" value="0.0" scope="parent"/>
      <xacro:property name="lift_base_link_izz" value="0.0127170180" scope="parent"/>


      <xacro:property name="base_to_lower_origin_z" value="0.295"/>

      <xacro:property name="lower_mass_value" value="19.521070"/>
      <xacro:property name="lower_box_size" value="0.163 0.163 0.575"/>
      <xacro:property name="lower_mesh_filename" value="file://$(find ewellix_liftkit_description)/meshes/visual/lift_low_700mm.dae"/>
      <xacro:property name="lift_lower_link_ixx" value="0.46604111" scope="parent"/>
      <xacro:property name="lift_lower_link_ixy" value="0.0" scope="parent"/>
      <xacro:property name="lift_lower_link_ixz" value="0.0" scope="parent"/>
      <xacro:property name="lift_lower_link_iyy" value="0.46480515" scope="parent"/>
      <xacro:property name="lift_lower_link_iyz" value="-0.002668667" scope="parent"/>
      <xacro:property name="lift_lower_link_izz" value="0.1561" scope="parent"/>


      <xacro:property name="lower_to_higher_origin_z" value="0.0915"/>

      <xacro:property name="middle_mass_value" value="15.593303"/>
      <xacro:property name="middle_box_size" value="0.146 0.146 0.483"/>
      <xacro:property name="middle_mesh_filename" value="file://$(find ewellix_liftkit_description)/meshes/visual/lift_mid_700mm.dae"/>
      <xacro:property name="lift_middle_link_ixx" value="0.34930648" scope="parent"/>
      <xacro:property name="lift_middle_link_ixy" value="0.0" scope="parent"/>
      <xacro:property name="lift_middle_link_ixz" value="0.0" scope="parent"/>
      <xacro:property name="lift_middle_link_iyy" value="0.34930648" scope="parent"/>
      <xacro:property name="lift_middle_link_iyz" value="0.0" scope="parent"/>
      <xacro:property name="lift_middle_link_izz" value="0.095393471" scope="parent"/>


      <xacro:property name="middle_to_higher_origin_z" value="-0.03397"/>
      <xacro:property name="middle_upper_limit" value="0.35"/>

      <xacro:property name="higher_mass_value" value="15.166778"/>
      <xacro:property name="higher_box_size" value="0.129 0.129 0.488"/>
      <xacro:property name="higher_mesh_filename" value="file://$(find ewellix_liftkit_description)/meshes/visual/lift_high_700mm.dae"/>
      <xacro:property name="lift_higher_link_ixx" value="0.35552099" scope="parent"/>
      <xacro:property name="lift_higher_link_ixy" value="0.000009631" scope="parent"/>
      <xacro:property name="lift_higher_link_ixz" value="0.000022848" scope="parent"/>
      <xacro:property name="lift_higher_link_iyy" value="0.35552876" scope="parent"/>
      <xacro:property name="lift_higher_link_iyz" value="0.000054910" scope="parent"/>
      <xacro:property name="lift_higher_link_izz" value="0.069925583" scope="parent"/>


      <xacro:property name="higher_to_top_origin_z" value="0.2515"/>

      <xacro:property name="top_mass_value" value="4.9139525"/>
      <xacro:property name="top_box_size" value="0.200 0.220 0.015"/>
      <xacro:property name="lift_top_link_ixx" value="0.02015548" scope="parent"/>
      <xacro:property name="lift_top_link_ixy" value="-0.000022811" scope="parent"/>
      <xacro:property name="lift_top_link_ixz" value="0.0" scope="parent"/>
      <xacro:property name="lift_top_link_iyy" value="0.01664141" scope="parent"/>
      <xacro:property name="lift_top_link_iyz" value="0.0" scope="parent"/>
      <xacro:property name="lift_top_link_izz" value="0.03661307" scope="parent"/>

      <xacro:property name="lift_tip_joint_origin_z" value="0.244"/>

    </xacro:if>


    <!--For 500 mm stroke-->
    <xacro:if value="${is_500}">

      <xacro:if value="${height_limit >= 0.5}">
        <xacro:property name="height_limit" value="0.5"/>
      </xacro:if>

      <xacro:property name="is_700" value="false"/>

      <xacro:property name="base_mass_value" value="1.7383784"/>
      <xacro:property name="base_box_size" value="0.220 0.200 0.015"/>
      <xacro:property name="lift_base_link_ixx" value="0.0057788774" scope="parent"/>
      <xacro:property name="lift_base_link_ixy" value="0" scope="parent"/>
      <xacro:property name="lift_base_link_ixz" value="0" scope="parent"/>
      <xacro:property name="lift_base_link_iyy" value="0.0070031719" scope="parent"/>
      <xacro:property name="lift_base_link_iyz" value="0" scope="parent"/>
      <xacro:property name="lift_base_link_izz" value="0.012717018" scope="parent"/>

      <xacro:property name="base_to_lower_origin_z" value="0.2457"/>

      <xacro:property name="lower_mass_value" value="6.746306"/>
      <xacro:property name="lower_box_size" value="0.163 0.163 0.4764"/>
      <xacro:property name="lower_mesh_filename" value="file://$(find ewellix_liftkit_description)/meshes/visual/lift_low_500mm.stl"/>
      <xacro:property name="lift_lower_link_ixx" value="0.1579129" scope="parent"/>
      <xacro:property name="lift_lower_link_ixy" value="0" scope="parent"/>
      <xacro:property name="lift_lower_link_ixz" value="0" scope="parent"/>
      <xacro:property name="lift_lower_link_iyy" value="0.1578582" scope="parent"/>
      <xacro:property name="lift_lower_link_iyz" value="0" scope="parent"/>
      <xacro:property name="lift_lower_link_izz" value="0.053799503" scope="parent"/>

      <xacro:property name="lower_to_higher_origin_z" value="0.0068"/>

      <xacro:property name="middle_mass_value" value="5.411604"/>
      <xacro:property name="middle_box_size" value="0.146 0.146 0.4794"/>
      <xacro:property name="middle_mesh_filename" value="file://$(find ewellix_liftkit_description)/meshes/visual/lift_mid_500mm.stl"/>
      <xacro:property name="lift_middle_link_ixx" value="0.11963018" scope="parent"/>
      <xacro:property name="lift_middle_link_ixy" value="0" scope="parent"/>
      <xacro:property name="lift_middle_link_ixz" value="0" scope="parent"/>
      <xacro:property name="lift_middle_link_iyy" value="0.11963018" scope="parent"/>
      <xacro:property name="lift_middle_link_iyz" value="0" scope="parent"/>
      <xacro:property name="lift_middle_link_izz" value="0.033099694" scope="parent"/>

      <xacro:property name="middle_to_higher_origin_z" value="-0.0053"/>
      <xacro:property name="middle_upper_limit" value="0.25"/>

      <xacro:property name="higher_mass_value" value="5.324879"/>
      <xacro:property name="higher_box_size" value="0.129 0.129 0.490"/>
      <xacro:property name="higher_mesh_filename" value="file://$(find ewellix_liftkit_description)/meshes/visual/lift_high_500mm.stl"/>
      <xacro:property name="lift_higher_link_ixx" value="0.12572077" scope="parent"/>
      <xacro:property name="lift_higher_link_ixy" value="0" scope="parent"/>
      <xacro:property name="lift_higher_link_ixz" value="0" scope="parent"/>
      <xacro:property name="lift_higher_link_iyy" value="0.12571806" scope="parent"/>
      <xacro:property name="lift_higher_link_iyz" value="0" scope="parent"/>
      <xacro:property name="lift_higher_link_izz" value="0.024552208" scope="parent"/>

      <xacro:property name="higher_to_top_origin_z" value="0.2525"/>

      <xacro:property name="top_mass_value" value="1.718423"/>
      <xacro:property name="top_box_size" value="0.200 0.220 0.015"/>
      <xacro:property name="lift_top_link_ixx" value="0.0058195514" scope="parent"/>
      <xacro:property name="lift_top_link_ixy" value="0.0" scope="parent"/>
      <xacro:property name="lift_top_link_ixz" value="0.00000800" scope="parent"/>
      <xacro:property name="lift_top_link_iyy" value="0.0070484261" scope="parent"/>
      <xacro:property name="lift_top_link_iyz" value="0.0" scope="parent"/>
      <xacro:property name="lift_top_link_izz" value="0.012803695" scope="parent"/>

      <xacro:property name="lift_tip_joint_origin_z" value="0.245"/>

    </xacro:if>

  <xacro:unless value="${not omit_plates}">
      <xacro:property name="lift_base_link_name" value="${tf_prefix}ewellix_lift_lower_link"/>
    </xacro:unless>

    <joint name="${tf_prefix}ewellix_lift_base_joint" type="fixed">
      <parent link="${parent}"/>
      <child link="${lift_base_link_name}"/>
      <xacro:insert_block name="origin"/>
    </joint>

    <!--BASE (omit_plates=false)-->
    <xacro:if value="${not omit_plates}">
      <link name="${tf_prefix}ewellix_lift_base_link">
        <inertial>
          <mass value="${base_mass_value}"/>
          <inertia ixx="${lift_base_link_ixx}" ixy="${lift_base_link_ixy}" ixz="${lift_base_link_ixz}" iyy="${lift_base_link_iyy}" iyz="${lift_base_link_iyz}" izz="${lift_base_link_izz}"/>
        </inertial>
        <visual>
          <geometry>
            <box size="${base_box_size}"/>
          </geometry>
          <material name="gray"/>
        </visual>
        <collision>
          <geometry>
            <box size="${base_box_size}"/>
          </geometry>
        </collision>
      </link>
    </xacro:if>

    <!--LOWER-->
    <link name="${tf_prefix}ewellix_lift_lower_link">
      <inertial>
        <mass value="${lower_mass_value}"/>
        <inertia ixx="${lift_lower_link_ixx}" ixy="${lift_lower_link_ixy}" ixz="${lift_lower_link_ixz}" iyy="${lift_lower_link_iyy}" iyz="${lift_lower_link_iyz}" izz="${lift_lower_link_izz}"/>
      </inertial>
      <visual>
        <geometry>
          <mesh filename= "${lower_mesh_filename}"/>
        </geometry>
        <material name="gray"/>
      </visual>
      <collision>
        <geometry>
          <box size="${lower_box_size}"/>
        </geometry>
      </collision>
    </link>

    <!--BASE TO LOWER (FIXED, omit_plates=false)-->
    <xacro:if value="${not omit_plates}">
      <joint name="${tf_prefix}base_to_lower" type="fixed">
        <parent link="${tf_prefix}ewellix_lift_base_link"/>
        <child link="${tf_prefix}ewellix_lift_lower_link"/>
        <origin xyz="0 0 ${base_to_lower_origin_z}" rpy="0 0 0"/>
      </joint>
    </xacro:if>

    <!--MIDDLE-->
    <link name="${tf_prefix}ewellix_lift_middle_link">
      <inertial>
        <mass value="${middle_mass_value}"/>
        <inertia ixx="${lift_middle_link_ixx}" ixy="${lift_middle_link_ixy}" ixz="${lift_middle_link_ixz}" iyy="${lift_middle_link_iyy}" iyz="${lift_middle_link_iyz}" izz="${lift_middle_link_izz}"/>
      </inertial>
      <visual>
        <geometry>
          <mesh filename= "${middle_mesh_filename}"/>
        </geometry>
        <material name="gray"/>
      </visual>
      <collision>
        <geometry>
          <box size="${middle_box_size}"/>
        </geometry>
      </collision>
    </link>

    <!--HIGHER-->
    <link name="${tf_prefix}ewellix_lift_higher_link">
      <inertial>
        <mass value="${higher_mass_value}"/>
        <inertia ixx="${lift_higher_link_ixx}" ixy="${lift_higher_link_ixy}" ixz="${lift_higher_link_ixz}" iyy="${lift_higher_link_iyy}" iyz="${lift_higher_link_iyz}" izz="${lift_higher_link_izz}"/>
      </inertial>
      <visual>
        <geometry>
          <mesh filename= "${higher_mesh_filename}"/>
        </geometry>
        <material name="gray"/>
      </visual>
      <collision>
        <geometry>
          <box size="${higher_box_size}"/>
        </geometry>
      </collision>
    </link>

    <!--LOWER TO HIGHER (PRISMATIC)-->
    <joint name="${tf_prefix}ewellix_lift_lower_to_higher" type="prismatic">
      <parent link="${tf_prefix}ewellix_lift_lower_link"/>
      <child link="${tf_prefix}ewellix_lift_higher_link"/>
      <origin xyz="0 0 ${lower_to_higher_origin_z}" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit lower="0" upper="${height_limit}" effort="1000" velocity="1"/>
    </joint>

    <!--MIDDLE MIMIC HIGHER (PRISMATIC MIMIC)-->
    <joint name="${tf_prefix}middle_mimic_higher" type="prismatic">
      <parent link="${tf_prefix}ewellix_lift_higher_link"/>
      <child link="${tf_prefix}ewellix_lift_middle_link"/>
      <origin xyz="0 0 ${middle_to_higher_origin_z}" rpy="0 0 0"/>
      <axis xyz="0 0 -1"/>
      <limit lower="0" upper="${middle_upper_limit}" effort="1000" velocity="1"/>
      <mimic joint="${tf_prefix}ewellix_lift_lower_to_higher" multiplier="0.5" offset="0"/>
    </joint>

     <!--TOP (omit_plates=false)-->
    <xacro:if value="${not omit_plates}">
      <link name="${tf_prefix}ewellix_lift_top_link">
        <inertia>
          <mass value="${top_mass_value}"/>
          <inertia ixx="${lift_top_link_ixx}" ixy="${lift_top_link_ixy}" ixz="${lift_top_link_ixz}" iyy="${lift_top_link_iyy}" iyz="${lift_top_link_iyz}" izz="${lift_top_link_izz}"/>
        </inertia>
        <visual>
          <geometry>
            <box size="${top_box_size}"/>
          </geometry>
          <material name="gray"/>
        </visual>
        <collision>
          <geometry>
            <box size="${top_box_size}"/>
          </geometry>
        </collision>
      </link>
    </xacro:if>

    <!--HIGHER TO TOP (FIXED, omit_plates=false)-->
    <xacro:if value="${not omit_plates}">
      <joint name="${tf_prefix}higher_to_top" type="fixed">
        <parent link="${tf_prefix}ewellix_lift_higher_link"/>
        <child link="${tf_prefix}ewellix_lift_top_link"/>
        <origin xyz="0 0 ${higher_to_top_origin_z}" rpy="0 0 0"/>
      </joint>
    </xacro:if>

    <link name="${tf_prefix}ewellix_lift_tip_link"/>

    <joint name="${tf_prefix}ewellix_lift_tip_joint" type="fixed">
      <parent link="${tf_prefix}ewellix_lift_higher_link"/>
      <child link="${tf_prefix}ewellix_lift_tip_link"/>
      <origin xyz="0 0 ${lift_tip_joint_origin_z}" rpy="0 0 0"/>
    </joint>

    <xacro:if value="${generate_ros2_control_tag}">
      <xacro:include filename="$(find ewellix_liftkit_description)/urdf/ewellix_liftkit.ros2_control.xacro" />
      <xacro:ewellix_liftkit_ros2_control
        name="${name}"
        use_fake_hardware="${use_fake_hardware}"
        use_gazebo="${use_gazebo}"
        tf_prefix="${tf_prefix}"
        com_port="${com_port}"
        height_limit="${height_limit}"
      />
    </xacro:if>
  </xacro:macro>
</robot>
