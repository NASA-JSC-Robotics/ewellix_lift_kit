<?xml version="1.0"?>


<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:include filename="$(find ewellix_liftkit_description)/urdf/properties.xacro"/>

  <xacro:macro name="ewellix_lift" params="
    name
    tf_prefix
    parent
    height_limit:=0.7
    omit_plates:=false
    use_fake_hardware:=false
    com_port:=/dev/ttyUSB0
  ">
    <!-- TODO work on abstracting this xacro to work for both 500 and 700mm lifts-->
    
    <!--BASE (omit_plates=false)-->
    <xacro:if value="${not omit_plates}">
      <link name="${tf_prefix}ewellix_lift_base_link">
        <inertia>
          <mass value="1.7383784"/>
          <inertia ixx="5.7788770e-03" ixy="0" ixz="0" iyy="7.0031715e-03" iyz="0" izz="1.2717018e-02"/>
        </inertia>
        <visual>
          <geometry>
            <box size="0.220 0.200 0.015"/>
          </geometry>
          <material name="gray"/>
        </visual>
        <collision>
          <geometry>
            <box size="0.220 0.200 0.015"/>
          </geometry>
        </collision>
      </link>
    </xacro:if>

    <!--LOWER-->
    <link name="${tf_prefix}ewellix_lift_lower_link">
      <inertia>
        <mass value="1.9521070e+01"/>
        <inertia ixx="0.46604111" ixy="0" ixz="0" iyy="0.46480515" iyz="-0.002668667" izz="0.1561"/>
      </inertia>
      <visual>
        <geometry>
          <mesh filename= "file://$(find ewellix_liftkit_description)/meshes/visual/lift_low.dae"/>
        </geometry>
        <material name="gray"/>
      </visual>
      <collision>
        <geometry>
          <box size="0.163 0.163 0.480"/>
        </geometry>
      </collision>
    </link>
    
    <!--BASE TO LOWER (FIXED, omit_plates=false)-->
    <xacro:if value="${not omit_plates}">
      <joint name="base_to_lower" type="fixed">
        <parent link="${tf_prefix}ewellix_lift_base_link"/>
        <child link="${tf_prefix}ewellix_lift_lower_link"/>
        <origin xyz="0 0 0.2475" rpy="0 0 0"/>
      </joint>
    </xacro:if>

    <!--MIDDLE-->
    <link name="${tf_prefix}ewellix_lift_middle_link">
      <inertia>
        <mass value="1.5593303e+01"/>
        <inertia ixx="0.34930648" ixy="0" ixz="0" iyy="0.34930648" iyz="0" izz="0.095393471"/>
      </inertia>
      <visual>
        <geometry>
          <mesh filename= "file://$(find ewellix_liftkit_description)/meshes/visual/lift_mid.dae"/>
        </geometry>
        <material name="gray"/>
      </visual>
      <collision>
        <geometry>
          <box size="0.146 0.146 0.483"/>
        </geometry>
      </collision>
    </link>

    <!--HIGHER-->
    <link name="${tf_prefix}ewellix_lift_higher_link">
      <inertia>
        <mass value="1.5166778e+01"/>
        <inertia ixx="0.35552099" ixy="9.6314989e-6" ixz="2.284786e-5" iyy="0.35552876" iyz="5.4910201e-5" izz="0.069925583"/>
      </inertia>
      <visual>
        <geometry>
          <mesh filename= "file://$(find ewellix_liftkit_description)/meshes/visual/lift_high.dae"/>
        </geometry>
        <material name="gray"/>
      </visual>
      <collision>
        <geometry>
          <box size="0.129 0.129 0.488"/>
        </geometry>
      </collision>
    </link>

    <!-- TODO Limit Upper Height -Mike -->
    <!--LOWER TO HIGHER (PRIS)-->
    <joint name="ewellix_lift_lower_to_higher" type="prismatic">
      <parent link="${tf_prefix}ewellix_lift_lower_link"/>
      <child link="${tf_prefix}ewellix_lift_higher_link"/>
      <origin xyz="0 0 0.0454" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit lower="0" upper="${height_limit}" effort="1000" velocity="1"/>
    </joint>

    <!--MIDDLE MIMIC HIGHER (PRIS MIMIC)-->
    <joint name="middle_mimic_higher" type="prismatic">
      <parent link="${tf_prefix}ewellix_lift_higher_link"/>
      <child link="${tf_prefix}ewellix_lift_middle_link"/>
      <origin xyz="0 0 -0.0222" rpy="0 0 0"/>
      <axis xyz="0 0 -1"/>
      <limit lower="0" upper="0.351" effort="1000" velocity="1"/>
      <mimic joint="ewellix_lift_lower_to_higher" multiplier="0.5" offset="0"/>
    </joint>

    <!--TOP (omit_plates=false)-->
    <xacro:if value="${not omit_plates}">
      <link name="${tf_prefix}ewellix_lift_top_link">
        <inertia>
          <mass value="4.9139525"/>
          <inertia ixx="0.02015548" ixy="-2.281101e-5" ixz="0" iyy="0.01664141" iyz="0" izz="0.03661307"/>
        </inertia>
        <visual>
          <geometry>
            <box size="0.200 0.220 0.015"/>
          </geometry>
          <material name="gray"/>
        </visual>
        <collision>
          <geometry>
            <box size="0.200 0.220 0.015"/>
          </geometry>
        </collision>
      </link>
    </xacro:if>

    <!--HIGHER TO TOP (FIXED, omit_plates=false)-->
    <xacro:if value="${not omit_plates}">
      <joint name="higher_to_top" type="fixed">
        <parent link="${tf_prefix}ewellix_lift_higher_link"/>
        <child link="${tf_prefix}ewellix_lift_top_link"/>
        <origin xyz="0 0 0.2515" rpy="0 0 0"/>
      </joint>
    </xacro:if>
    
    <xacro:include filename="$(find ewellix_liftkit_description)/urdf/ewellix_liftkit.ros2_control.xacro" />
    <xacro:ewellix_liftkit_ros2_control
      name="${name}"
      use_fake_hardware="${use_fake_hardware}"
      tf_prefix="${tf_prefix}"
      com_port="${com_port}"
      height_limit="${height_limit}"
    />


  </xacro:macro>
  
</robot>